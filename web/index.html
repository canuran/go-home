<!DOCTYPE html>
<html lang="cn">

<head>
    <meta charset="utf-8">
    <title>管理平台</title>
    <meta name="keywords" content="管理平台">
    <meta name="description" content="管理平台">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="image/favicon.ico">
    <link rel="stylesheet" href="lib/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="lib/font-awesome/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="css/layuimini.css" media="all">
    <link rel="stylesheet" href="css/themes/default.css" media="all">
    <link rel="stylesheet" href="lib/GridManager/index.css" media="all">
    <style id="layuimini-bg-color">
    </style>
</head>

<body class="layui-layout-body layuimini-all">
<div class="layui-layout layui-layout-admin">

    <div class="layui-header header">
        <div class="layui-logo layuimini-logo layuimini-back-home"></div>

        <div class="layuimini-header-content">
            <a>
                <div class="layuimini-tool"><i title="展开" class="fa fa-outdent" data-side-fold="1"></i></div>
            </a>

            <!--电脑端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-menu-header-pc layuimini-pc-show"></ul>

            <!--手机端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-mobile-show">
                <li class="layui-nav-item">
                    <a><i class="fa fa-list-ul"></i> 模块导航</a>
                    <dl class="layui-nav-child layuimini-menu-header-mobile">
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item layuimini-setting" style="margin-right:10px">
                    <a href="javascript:">
                        <img id='loginerHeader' style="width:32px;height:32px;border-radius:16px"/>
                        <span id="loginerName">点击登录</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a layuimini-content-href="page/user/user-profile.html" data-title="基本资料"
                               data-icon="fa fa-gears">用户设置</a></dd>
                        <dd>
                            <hr>
                        </dd>
                        <dd><a id="login-out">退出登录</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item" lay-unselect>
                    <a href="javascript:" data-refresh="刷新"><i class="fa fa-refresh"></i></a>
                </li>
                <li class="layui-nav-item mobile layui-hide-xs" lay-unselect>
                    <a href="javascript:" data-check-screen="full"><i class="fa fa-arrows-alt"></i></a>
                </li>
                <li class="layui-nav-item layuimini-select-bgcolor" lay-unselect>
                    <a href="javascript:" data-bgcolor="配色方案"><i class="fa fa-th-list"></i></a>
                </li>
            </ul>
        </div>
    </div>

    <!--无限极左侧菜单-->
    <div class="layui-side layui-bg-black layuimini-menu-left"></div>

    <!--手机端遮罩层-->
    <div class="layuimini-make"></div>

    <!-- 移动导航 -->
    <div class="layuimini-site-mobile"><i class="layui-icon"></i></div>

    <div class="layui-body" style="padding-bottom: 0">
        <!-- 主体区域 -->
        <div class="layuimini-content-page"></div>
    </div>
</div>
<script src="lib/jquery/jquery.js" charset="utf-8"></script>
<script src="lib/layui/layui.js" charset="utf-8"></script>
<script src="lib/xm-select/xm-select.js" charset="utf-8"></script>
<script src="lib/GridManager/index.js" charset="utf-8"></script>
<script src="lay/lay-config.js" charset="utf-8"></script>
<script>
    var srvPath = "/srv"
    var webPath = "/web"
    var defaultHeader = "/9j/2wCEAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRQBAwQE" +
        "BQQFCQUFCRQNCw0UFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFP/AABEIAGQAZAMBIgAC" +
        "EQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQy" +
        "gZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeI" +
        "iYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEB" +
        "AQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEK" +
        "FiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Sl" +
        "pqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AP0tooooAKKKKACi" +
        "iigAooooAKKKKACiiigAooooAKKKKACiiigAopk0yW8LyyMFjQFmY9hXm2ueLrvVJmWGRre1BwqIcEj1JoA9NxSV49b6ld2kgkiu" +
        "ZUcc5DmvQPCfif8AtuNoJwFu4xkkcBx60AdDRRRQAUUUUAFFFFABRRRQAUUUUAc947uGh0BlU48yRUP05P8ASvNq9U8U6c2p6JPF" +
        "GN0q4dR6kf8A1s15X0oAK1PDE7W+v2TJ/FIEP0PFZdb3grTnvdbil2/urf52b37CgD0yiiigAooooAKKKKACiiigAoopGYIpZiFU" +
        "ckk4AoAWvNvHGnw2GsBoQFEyeYyDsc4P510GteO7az3RWQF1KON/8A/xrhL29m1C5ee4cySt1J/lQBDXq3hrT4dP0e3WIDMiCR3/" +
        "ALxIrymug0DxhcaOiwSr9otR0UnDL9D/AEoA9KoqjpetWesR7raUMw6xnhl+oq9QAUUUUAFFFFABRRRQAteW+IfEl1rFxIhcx2ysQ" +
        "sSng47n1r1KuPn+HUMkzul7IisxIUxg4/HNAHCUV3H/AAreP/oIP/36H+NH/Ct4/wDoIP8A9+h/jQBw9Fdx/wAK3j/6CD/9+h/jR/" +
        "wreP8A6CD/APfof40AcVDPJbSrJE7RyLyGU4Ir0jwfrs2tWUouADNCQpcfxZ7/AF4rM/4VvH/0EH/79D/Gt3w94ej8PwyokrTNKw" +
        "LMwx06cUAatFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH//"

    layui.use(['miniAdmin'], function () {
        var options = {
            iniUrl: "api/init.json",    // 初始化接口
            bgColorDefault: false,      // 主题默认配置
            multiModule: true,          // 是否开启多模块
            menuChildOpen: false,       // 是否默认展开菜单
            pageAnim: true,             // 切换菜单动画
        };

        layui.miniAdmin.render(options);
        updateLoginInfo();

        $('#login-out').on("click", function () {
            $.get(srvPath + '/logout', {}, function () {
                window.location.href = webPath + "/login.html";
            });
        });
    });

    $.ajaxSetup({
        error: function (xhr) {
            if (xhr.status === 401) {
                var loginerName = $('#loginerName');
                loginerName.html('点击登录');
                loginerName.click(openLoginLayer);
                $('#loginerHeader').attr('src', 'data:image;base64,' + defaultHeader)
                openLoginLayer()
            } else {
                layui.layer.msg("请求失败", {icon: 2})
            }
        }
    });

    var loginIndex = 0;

    function openLoginLayer() {
        loginIndex = loginIndex ? loginIndex : layui.layer.open({
            type: 2,
            resize: false,
            area: ['800px', '650px'],
            title: '<i class="fa fa-list"></i> 用户登录',
            content: webPath + "/login.html"
        });
        return false;
    }

    function closeLoginLayer() {
        layui.layer.close(loginIndex);
        loginIndex = 0;
    }

    function updateLoginInfo() {
        $.get(srvPath + '/loginer', {}, function (data) {
            var loginerName = $('#loginerName');
            loginerName.html(data.data && data.data.name);
            loginerName.unbind('click');
            $('#loginerHeader').attr('src', 'data:image;base64,' + (data.data && data.data.header))
        });
    }

    /*获取当前Url里面的参数*/
    function getUrlParams() {
        return getParamsByUrl(window.location.href);
    }

    /*获取指定Url里面的参数*/
    function getParamsByUrl(url) {
        var params = {}
        var reg = /[?&](\w+)=([^&]*)/g;
        var matches = (url || "").matchAll(reg);
        for (var match of matches) {
            params[match[1]] = decodeURIComponent(match[2]);
        }
        return params;
    }

    function encodeUriParams(params) {
        params = params || {};
        var paramStr = ""
        for (const key in params) {
            var value = encodeURIComponent(params[key] || "");
            if (value.length < 1024) {
                paramStr += value ? ((paramStr ? "&" : "") + key + "=" + value) : "";
            } else {
                console.log(paramStr + " too long");
            }
        }
        return paramStr;
    }

    // 设置当前浏览器url参数
    function setUrlParams(params) {
        var paramStr = encodeUriParams(params);
        paramStr = paramStr ? "?" + paramStr : paramStr;
        var href = window.location.href;
        var uriEnd = href.indexOf("?");
        if (uriEnd > 0) {
            href = window.location.href.substring(0, uriEnd);
        }
        window.history.replaceState({}, "", href + paramStr);
    }

    function formatDateTime(value) {
        if (value && value.length > 19) {
            value = value.substring(0, 19)
        }
        return value && value.replace("T", " ")
    }

    function gmTimeTemplate(cell, row, index, key) {
        return formatDateTime(row[key]);
    }

    function gmStrongTemplate(cell, row, index, key) {
        return '<strong>' + (row[key] || '') + '</strong>'
    }

    function gmPreTemplate(cell, row, index, key) {
        return '<pre>' + replaceHtmlTag(row[key]) + '</pre>'
    }

    function replaceHtmlTag(input) {
        return (input || "").replace(/</g, "&lt;").replace(/</g, "&gt;")
    }

    function gmAjaxTotals(settings, params) {
        return new Promise(resolve => {
            params.count = true
            $.post(settings.ajaxUrl || "", params, function (data) {
                resolve(data.totals);
            }, 'json')
        });
    }

    function gmAjaxData(settings, params) {
        return new Promise(resolve => {
            $.post(settings.ajaxUrl || "", params, function (data) {
                resolve(data);
            }, 'json');
        });
    }
</script>
</body>

</html>