<!--该页由index.html加载，所有资源路径应该相对于index.html-->
<link rel="stylesheet" href="module/cropper/cropper.css">

<style>
    #avatar {
        width: 200px;
        height: 200px;
        border-radius: 100px
    }

    #preview {
        width: 200px;
        height: 200px;
        border-radius: 100px;
        overflow: hidden
    }

    #avatar:hover {
        filter: alpha(Opacity=80);
        -moz-opacity: 0.8;
        opacity: 0.8
    }
</style>

<div class="layui-card" style="margin:10px;padding:10px">
    <div class="layui-row">
        <div class="layui-col-sm4">
            <label style="cursor:pointer;margin:10px">
                <img id="avatar" src="image/back.png" alt="avatar"/>
                <input type="file" id="input" name="image" accept="image/*" hidden/>
            </label>
        </div>
        <div class="layui-col-sm4">
            <div id="preview"></div>
        </div>
    </div>

    <div style="margin:10px;width:800px">
        <div class="layui-btn-group" style="margin:10px">
            <button class="layui-btn" id="crop">裁剪</button>
            <button class="layui-btn layui-btn-normal" id="rotateL">左旋转</button>
            <button class="layui-btn layui-btn-warm" id="rotateR">右旋转</button>
            <button class="layui-btn layui-btn-normal" id="scaleX">左右翻转</button>
            <button class="layui-btn layui-btn-warm" id="scaleY">上下翻转</button>
        </div>
        <img id="image" src="image/back.png" width="800px" alt="avatar"/>
    </div>
</div>
<script src="module/cropper/cropper.js"></script>

<script type="text/javascript">
    $(function () {
        var avatar = document.getElementById('avatar');
        var image = document.getElementById('image');
        var newCropper = function (image) {
            return new Cropper(image, {
                aspectRatio: 1,
                viewMode: 1,
                preview: document.getElementById('preview')
            });
        }
        var cropper = newCropper(image);

        $("#input").on('change', function (e) {
            var files = e.target.files;
            var done = function (url) {
                image.src = url;
                if (cropper) {
                    cropper.replace(url);
                } else {
                    cropper = newCropper(image);
                }
            };

            if (files && files.length) {
                var file = files[0];
                if (URL) {
                    done(URL.createObjectURL(file));
                } else if (FileReader) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        done(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        $('#rotateL').on('click', function () {
            if (cropper) {
                cropper.rotate(-90);
            }
        });

        $('#rotateR').on('click', function () {
            if (cropper) {
                cropper.rotate(90);
            }
        });

        $('#scaleX').on('click', function () {
            if (cropper) {
                var scaleX = cropper.getImageData().scaleX
                cropper.scaleX(-(scaleX ? scaleX : 1));
            }
        });

        $('#scaleY').on('click', function () {
            if (cropper) {
                var scaleY = cropper.getImageData().scaleY
                cropper.scaleY(-(scaleY ? scaleY : 1));
            }
        });

        $('#crop').on('click', function () {
            if (cropper) {
                var canvas = cropper.getCroppedCanvas({
                    width: 500,
                    height: 500,
                });
                avatar.src = canvas.toDataURL();
            }
        });
    });
</script>