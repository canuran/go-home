<link rel="stylesheet" href="lib/cropper/cropper.css">

<div class="layui-card" style="margin:10px;padding:10px">
    <div class="layui-row">
        <div class="layui-col-sm3">
            <label style="cursor:pointer;margin:10px">
                <img id="avatar" src="image/logo.png" alt="avatar"
                     style="width:200px;border-radius:100px"/>
                <input type="file" id="input" name="image" accept="image/*" hidden/>
            </label>
        </div>
        <div class="layui-col-sm3">
            <div id="preview" style="width:180px;height:180px;overflow:hidden"></div>
        </div>
    </div>

    <div style="margin:10px;width:800px">
        <div class="layui-btn-group" style="margin:10px">
            <button class="layui-btn" id="crop">裁剪</button>
            <button class="layui-btn layui-btn-warm" id="rotate">旋转</button>
            <button class="layui-btn" id="scaleX">左右翻转</button>
            <button class="layui-btn layui-btn-normal" id="scaleY">上下翻转</button>
            <button class="layui-btn layui-btn-danger" id="cancel">取消</button>
        </div>
        <img id="image" src="image/logo.png" width="800px" alt="avatar"/>
    </div>
</div>
<script src="lib/cropper/cropper.js"></script>

<script>
    function newCropper(image) {
        return new Cropper(image, {
            aspectRatio: 1,
            viewMode: 1,
            preview: document.getElementById('preview')
        });
    }

    $(document).ready(function () {
        var avatar = document.getElementById('avatar');
        var image = document.getElementById('image');
        var cropper = newCropper(image);

        $("#input").on('change', function (e) {
            var files = e.target.files;
            var done = function (url) {
                image.src = url;
                cropper.replace(url);
            };

            if (files && files.length) {
                var file = files[0];
                if (URL) {
                    done(URL.createObjectURL(file));
                } else if (FileReader) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        done(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        $('#rotate').on('click', function () {
            if (cropper) {
                cropper.rotate(90);
            }
        });

        $('#scaleX').on('click', function () {
            if (cropper) {
                var scaleX = cropper.getImageData().scaleX
                cropper.scaleX(-(scaleX ? scaleX : 1));
            }
        });

        $('#scaleY').on('click', function () {
            if (cropper) {
                var scaleY = cropper.getImageData().scaleY
                cropper.scaleY(-(scaleY ? scaleY : 1));
            }
        });

        $('#cancel').on('click', function () {
            if (cropper) {
                cropper.destroy();
            }
        });

        $('#crop').on('click', function () {
            if (cropper) {
                var canvas = cropper.getCroppedCanvas({
                    width: 200,
                    height: 200,
                });
                avatar.src = canvas.toDataURL();
            }
        });
    });
</script>